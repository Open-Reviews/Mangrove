variables:
  S3_BUCKET: "mangrove.reviews"
  CDN_DISTRIBUTION_ID: "E3R6KTTYJH0XRG"
  CI_DEBUG_TRACE: "true"
  VUE_APP_API_URL: "https://api.mangrove.reviews"
  VUE_APP_FILES_URL: "https://files.mangrove.reviews"
  VUE_APP_UPLOAD_URL: "https://upload.mangrove.reviews"

image: wilson208/circleci-awscli:node
cache:
  key: ${CI_COMMIT_REF_SLUG}
  paths:
  - ui/node_modules/

build:
  script:
  - cd ui
  - yarn install
  - yarn generate

pages:
  variables:
    BASE_URL: "https://plantingspace.gitlab.io/mangrove"
  stage: deploy
  script:
  - cd ui
  - yarn install
  - yarn generate
  - cd ..
  - mkdir public
  - cp -r ui/dist/* public
  artifacts:
    paths:
    - public
  except:
  - master

production:
  variables:
    BASE_URL: "https://mangrove.reviews"
  stage: deploy
  script:
  - cd ui
  - yarn install
  - yarn generate
  - aws s3 rm s3://$S3_BUCKET --recursive
  - aws s3 cp --recursive ./dist s3://$S3_BUCKET
  only:
  - master
